 
 CREATE DATABASE:
 create database taxi location '/user/raj_ops/greatlearning'; 



 CREATE TABLE :   

 create table yellow_taxi
 (
     vendor_id string, pickup_datetime string, dropoff_datetime string, passenger_count int, 
     trip_distance DECIMAL(9,6), pickup_longitude DECIMAL(9,6), pickup_latitude DECIMAL(9,6), rate_code int
     , store_and_fwd_flag string, dropoff_longitude DECIMAL(9,6), dropoff_latitude DECIMAL(9,6), payment_type string, 
     fare_amount DECIMAL(9,6), extra DECIMAL(9,6), mta_tax DECIMAL(9,6), tip_amount DECIMAL(9,6),
     tolls_amount DECIMAL(9,6), total_amount DECIMAL(9,6), trip_time_in_secs int
 )                                                                                                   
  row format delimited
  fields terminated by ','
  stored as textfile
  tblproperties('skip.header.line.count'='1');



 LOAD DATA :

 load data inpath '/user/raj_ops/greatlearning/yellow_tripdata.csv' into table yellow_taxi;



 QUERIES :

 1. What is the total number of trips ( equal to the number of rows)?
 Sol.  select count(*) as total_trips from yellow_taxi;


 2. What is the total revenue generated by all the trips? The fare is stored in the column total_amount.
 Sol.  select sum(total_amount) as total_revenue from yellow_taxi;


 3. What fraction of the total is paid for tolls? The toll is stored in tolls_amount.
 Sol.  select ((sum(tolls_amount)/sum(total_amount))*100) as fraction_amount from yellow_taxi;


 4. What fraction of it is driver tips? The tip is stored in tip_amount.
 Sol.  select ((sum(tip_amount)/sum(total_amount))*100) as fraction_amount from yellow_taxi;


 5. What is the average trip amount?
 Sol.  select AVG(total_amount) as avgTripAmount from yellow_taxi;


 6. What is the average distance of the trips? Distance is stored in the column trip_distance.
 Sol.  select AVG(trip_distance) as avgDistance from yellow_taxi;


 7. How many different payment types are used?
 Sol.  select distinct payment_type from yellow_taxi;


 8. For each payment type, display the following details:
   (a) Average fare generated
   Sol.  select payment_type , AVG(fare_amount) as avgFare from yellow_taxi group by payment_type ;

   (b) Average tip
   Sol.  select payment_type , AVG(tip_amount ) as avgTip from yellow_taxi group by payment_type ;

   (c) Average tax â€“ tax is stored in column mta_tax
   Sol.  select payment_type , AVG(mta_tax  ) as avgTax from yellow_taxi group by payment_type ;


 9. On average which hour of the day generates the highest revenue?
 Sol.  select h24 as time, AVG(total_amount) as avgAmount 
       from (select hour(pickup_datetime) as h24, total_amount from yellow_taxi)
       ff
       group by h24 order by avgAmount DESC;
 
 